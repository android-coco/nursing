{{template "header_top" .}}
<!-- Begin page -->
<div class="am-topbar am-topbar-fixed-top top48">
    <div class="am-topbar-left am-hide-sm-only"></div>
    <div class="contain">
        <div class="jky-class-bar"></div>
        <div class="jky-tab-hd">
            <ul>
                <li><a href="/pc/batvhinput">批量录入</a></li>
                <li class="active"><a href="/pc/patvhhistory">历史数据</a></li>
            </ul>
        </div>
    </div>
</div>


    <div class="admin">
        <!--<div class="am-g">-->
        <!-- ========== Left Sidebar Start ========== -->
        <!--<div class="left side-menu am-hide-sm-only am-u-md-1 am-padding-0">
			<div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 548px;">
				<div class="sidebar-inner slimscrollleft" style="overflow: hidden; width: auto; height: 548px;">-->
        <!-- sidebar start -->
        {{template "header_side" .}}
        <!-- sidebar end -->

        <!--</div>
			</div>
		</div>-->
        <!-- ========== Left Sidebar end ========== -->




        <div class="content-page none" data-index="1" style="margin-top: 88px;"></div>


        <div class="content-page type2" data-index="2" style="margin-top: 88px;">
            <div class="content ">
                <div class="am-g">
                    <form   method = 'post'  action="/pc/patvhhistory" style="display: block;height: 100%;" id="search-from">
                        <div class="history-batchInput">
                        <div class="s-btn">
                            <!-- <img src="../dist/images/admin_pc/icon22.png" alt=""> -->
                        </div>
                        <div class="user-warp">
                            <div class="tit-bar">
                                <input type="checkbox" id="all-btn" checked> <label for="all-btn">全部患者</label>
                            </div>

                            <div class="user-bar">
                                <div class="tit">
                                    <div class="l">
                                        床号
                                    </div>
                                    <div class="r">
                                        姓名
                                    </div>
                                </div>
                                <div class="user-list">
                                    {{range .Patients}}
                                    <ul>
                                        <li data-id="{{.PatientId}}" >
                                            <div class="l">
                                                <input type="checkbox" {{if eq .Checked 1 }} checked {{end}}><label>{{.BedCoding}}</label>
                                            </div>
                                            <div class="r">
                                                {{.Name}}
                                            </div>
                                        </li>
                                    </ul>
                                    {{end}}
                                </div>
                            </div>
                        </div>
                        <div class="hd-bar">
                            <div class="date-box fl">
                                <!--<div class="icon">-->
                                    <!--<img src="/static/dist/images/admin_pc/icon20.png" alt="" />-->
                                <!--</div>-->


                                <input type="text" class="am-form-field  date-input startTime" id="date1" />
                                <span>时段：</span>
                                <select class="time-block startTimeBlcok">
                                    <option  value="4" {{if eq .startframe "4" }} selected="" {{end}} >4</option>
                                    <option value="8"  {{if eq .startframe "8" }} selected="" {{end}}>8</option>
                                    <option value="12" {{if eq .startframe "12" }} selected="" {{end}}>12</option>
                                    <option value="16" {{if eq .startframe "16" }} selected="" {{end}}>16</option>
                                    <option value="20" {{if eq .startframe "20" }} selected="" {{end}}>20</option>
                                    <option value="24" {{if eq .startframe "24" }} selected="" {{end}}>24</option>
                                </select>
                                <i class="line">——</i>
                                <input type="text" class="am-form-field  date-input endTime" id="date2" />
                                <span>时段：</span>
                                <select class="time-block endTimeBlock">
                                    <option value="4"  {{if eq .endframe "4" }} selected="" {{end}}>4</option>
                                    <option value="8"  {{if eq .endframe "8" }} selected="" {{end}}>8</option>
                                    <option value="12" {{if eq .endframe "12" }} selected="" {{end}}>12</option>
                                    <option value="16" {{if eq .endframe "16" }} selected="" {{end}}>16</option>
                                    <option value="20" {{if eq .endframe "20" }} selected="" {{end}}>20</option>
                                    <option value="24" {{if eq .endframe "24" }} selected="" {{end}}>24</option>
                                </select>
                                <a  class="search-btn" id="search-btn">搜索</a>
                            </div>
                            <div class="btn-group fr">
                                {{/*<a href="" class="btn">打印</a>*/}}
                                <!--<a href="" class="btn">导出</a>-->
                                <!-- <a href="" class="btn type2">保存</a> -->
                            </div>
                        </div>
                        <div class="batchInput-box">
                            <div class="scroll-box">
                                <div class="warp-box">
                                    <table class="cont-table fx">
                                        <thead class="table-hd">
                                            <tr>
                                                <th class="th1" rowspan="2">床号</th>
                                                <th class="th2" rowspan="2">姓名</th>
                                                <th class="th3" rowspan="2">年龄</th>
                                                <th class="th18" rowspan="2">时间</th>
                                                <th class="th4" rowspan="2">体温(℃）</th>
                                                <th class="th5" rowspan="2">脉搏(次／分）</th>
                                                <th class="th6" rowspan="2">呼吸(次／分）</th>
                                                <th class="th9" rowspan="2">大便（次）</th>
                                                <th class="th7" rowspan="2">血压(mmHg）</th>
                                                <th class="th8" rowspan="2">心率(次／分）</th>
                                                <th class="th11" rowspan="2">体重(kg)</th>
                                                <th class="th12" rowspan="2">身高(cm)</th>
                                                <th class="th13" rowspan="2">皮试</th>
                                                <th class="th14" rowspan="2">其他</th>
                                                <th class="th16" rowspan="2">事件</th>
                                                <th class="th17" rowspan="2">操作</th>
                                            </tr>

                                        </thead>
                                    </table>
                                    <table class="cont-table">
                                        <thead class="table-hd">
                                            <tr>
                                                <th class="th1" rowspan="2">床号</th>
                                                <th class="th2" rowspan="2">姓名</th>
                                                <th class="th3" rowspan="2">年龄</th>
                                                <th class="th18" rowspan="2">时间</th>
                                                <th class="th4" rowspan="2">体温(℃）</th>
                                                <th class="th5" rowspan="2">脉搏(次／分）</th>
                                                <th class="th6" rowspan="2">呼吸(次／分）</th>
                                                <th class="th9" rowspan="2">大便（次）</th>
                                                <th class="th7" rowspan="2">血压(mmHg）</th>
                                                <th class="th8" rowspan="2">心率(次／分）</th>
                                                <th class="th11" rowspan="2">体重(kg)</th>
                                                <th class="th12" rowspan="2">身高(cm)</th>
                                                <th class="th13" rowspan="2">皮试</th>
                                                <th class="th14" rowspan="2">其他</th>
                                                <th class="th16" rowspan="2">事件</th>
                                                <th class="th17" rowspan="2">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        {{range .signhistorys}}
                                            <tr data-pid="{{.PatientId}}" data-nid="{{$.Userinfo.UID}}" data-nname="{{$.Userinfo.Name}}">
                                                <td class="pd8"><span>{{.PatientBed}}</span></td>
                                                <td class="pd8"><span>{{.PatientName}}</span></td>
                                                <td class="pd8"><span>{{.PatientAge}}</span></td>
                                                <td class="date-time-td">
                                                    <div class="text-msg">
                                                        {{.DateTime}} 时段:{{.TimeFrame}}
                                                    </div>
                                                    <div class="table-input-bar"  style="text-align: center" >
                                                        {{.DateTime}} 时段:{{.TimeFrame}}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="table-input-bar">
                                                        <input type="text" id="row1_input1" class="input1 thmValue" value="{{.ThmValue}}">
                                                        <!--<span>
                                                            {{if eq .ThmType 1 }}腋温{{end}}
                                                            {{if eq .ThmType 2 }}耳温{{end}}
                                                            {{if eq .ThmType 3 }}口温{{end}}
                                                            {{if eq .ThmType 4 }}肛温{{end}}
                                                            {{if eq .ThmType 5 }}额温{{end}}


                                                        </span>-->
                                                        <select  class="abs type1 thmType" disabled>
                                                            <option {{if eq .ThmType 0 }} selected="" {{end}} value="0">&nbsp;</option>
                                                            <option {{if eq .ThmType 1 }} selected="" {{end}} value="1">腋温</option>
                                                            <option {{if eq .ThmType 2 }} selected="" {{end}} value="2">耳温</option>
                                                            <option {{if eq .ThmType 3 }} selected="" {{end}} value="3">口温</option>
                                                            <option {{if eq .ThmType 4 }} selected="" {{end}} value="4">肛温</option>
                                                            <option {{if eq .ThmType 5 }} selected="" {{end}} value="5">额温</option>
                                                        </select>
                                                        <select  class="abs thmScene">
                                                            <option {{if eq .ThmScene 0 }} selected="" {{end}} value="0">&nbsp;</option>
                                                            <option {{if eq .ThmScene 1 }} selected="" {{end}} value="1">物理降温</option>
                                                            <option {{if eq .ThmScene 2 }} selected="" {{end}} value="2">药物降温</option>
                                                            <option {{if eq .ThmScene 3 }} selected="" {{end}} value="3">冰毯降温</option>
                                                            <option {{if eq .ThmScene 4 }} selected="" {{end}} value="4">停冰毯降温</option>
                                                            <option {{if eq .ThmScene 5 }} selected="" {{end}} value="5">药物+物理降温</option>
                                                            <option {{if eq .ThmScene 6 }} selected="" {{end}} value="6">无降温</option>
                                                            <option {{if eq .ThmScene 7 }} selected="" {{end}} value="7">不升</option>
                                                            <option {{if eq .ThmScene 8 }} selected="" {{end}} value="8">外出</option>
                                                            <option {{if eq .ThmScene 9 }} selected="" {{end}} value="9">检查</option>
                                                            <option {{if eq .ThmScene 10 }} selected="" {{end}} value="10">请假</option>
                                                            <option {{if eq .ThmScene 11 }} selected="" {{end}} value="11">拒试</option>
                                                            <option {{if eq .ThmScene 12 }} selected="" {{end}} value="12">无法测</option>
                                                            <option {{if eq .ThmScene 13 }} selected="" {{end}} value="13">不在</option>
                                                        </select>
                                                    </div>
                                                    <div class="text-msg">
                                                        {{.ThmValue}}
                                                        {{if eq .ThmType 1 }} 腋温 {{end}}
                                                        {{if eq .ThmType 2 }} 耳温 {{end}}
                                                        {{if eq .ThmType 3 }} 口温 {{end}}
                                                        {{if eq .ThmType 4 }} 肛温 {{end}}
                                                        {{if eq .ThmType 5 }} 额温 {{end}}

                                                        {{if eq .ThmScene 1 }} 物理降温 {{end}}
                                                        {{if eq .ThmScene 2 }} 药物降温 {{end}}
                                                        {{if eq .ThmScene 3 }} 冰毯降温 {{end}}
                                                        {{if eq .ThmScene 4 }} 停冰毯降温 {{end}}
                                                        {{if eq .ThmScene 5 }} 药物+物理降温 {{end}}
                                                        {{if eq .ThmScene 6 }} 无降温 {{end}}
                                                        {{if eq .ThmScene 7 }} 不升 {{end}}
                                                        {{if eq .ThmScene 8 }} 外出 {{end}}
                                                        {{if eq .ThmScene 9 }} 检查 {{end}}
                                                        {{if eq .ThmScene 10 }} 请假 {{end}}
                                                        {{if eq .ThmScene 11 }} 拒试 {{end}}
                                                        {{if eq .ThmScene 12 }} 无法测 {{end}}
                                                        {{if eq .ThmScene 12 }} 不在 {{end}}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="table-input-bar">
                                                        <input type="text" id="row1_input3" class="input1 pulseValue" value="{{.PulseValue}}">
                                                        <div class="check-bar">
                                                            <input type="checkbox" id="row1_input4" class="pulseBriefness" {{if eq .PulseBriefness 1 }} checked {{end}}>
                                                            <label for="row1_input4">
                                                                短绌
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="text-msg">
                                                        {{.PulseValue}}
                                                        {{if eq .PulseBriefness 1 }} 短绌 {{end}}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="table-input-bar">
                                                        <input type="text" id="row1_input5" class="input1 breatheValue" value="{{.BreatheValue}}">
                                                        <select id="row1_input6" class="abs breatheScene">
                                                            <option value="0" {{if eq .BreatheScene 0}} selected="" {{end}} value="0">&nbsp;</option>
                                                            <option value="1" {{if eq .BreatheScene 1}} selected="" {{end}} value="1">辅助呼吸</option>
                                                            <option value="2" {{if eq .BreatheScene 2}} selected="" {{end}} value="2">停辅助呼吸</option>
                                                        </select>
                                                    </div>
                                                    <div class="text-msg">
                                                        {{.BreatheValue}}
                                                        {{if eq .BreatheScene 1 }} 辅助呼吸 {{end}}
                                                        {{if eq .BreatheScene 2 }} 停辅助呼吸 {{end}}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="table-input-bar">
                                                        <input type="text" id="row1_input11" class="input1 shitValue" value="{{.ShitValue}}">
                                                        <select id="row1_input12" class="abs shitScene">
                                                            <option {{if eq .ShitScene 0 }} selected="" {{end}} value="0">&nbsp;</option>
                                                            <option {{if eq .ShitScene 1 }} selected="" {{end}} value="1">*</option>
                                                            <option {{if eq .ShitScene 2 }} selected="" {{end}} value="2">/E</option>
                                                            <option {{if eq .ShitScene 3 }} selected="" {{end}} value="3">*/E</option>
                                                            <option {{if eq .ShitScene 4 }} selected="" {{end}} value="4">1，1/E</option>
                                                        </select>
                                                    </div>

                                                    <div class="text-msg">
                                                        {{.ShitValue}}
                                                        {{if eq .ShitScene 1 }} * {{end}}
                                                        {{if eq .ShitScene 2 }} /E {{end}}
                                                        {{if eq .ShitScene 3 }} */E {{end}}
                                                        {{if eq .ShitScene 4 }} 1，1/E {{end}}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="table-input-bar">
                                                        <input class="i1 pressureSys" type="text" id="row1_input7" value="{{.PressureSys}}">/
                                                        <input class="i1 pressureDia" type="text" id="row1_input8" value="{{.PressureDia}}">
                                                        <select id="row1_input9" class="abs pressureScene">
                                                            <option value="0" {{if eq .PressureScene 0 }}  selected="" {{end}}>&nbsp;</option>
                                                            <option value="1" {{if eq .PressureScene 1 }}  selected="" {{end}}>外出</option>
                                                            <option value="2" {{if eq .PressureScene 2 }}  selected="" {{end}}>检查</option>
                                                            <option value="3" {{if eq .PressureScene 3 }}  selected="" {{end}}>请假</option>
                                                            <option value="4" {{if eq .PressureScene 4 }}  selected="" {{end}}>拒试</option>
                                                            <option value="5" {{if eq .PressureScene 5 }}  selected="" {{end}}>无法测</option>
                                                            <option value="6" {{if eq .PressureScene 6 }}  selected="" {{end}}>不在</option>
                                                        </select>
                                                    </div>
                                                    <div class="text-msg">
                                                        {{.PressureSys}} / {{.PressureDia}}
                                                        {{if eq .PressureScene 1 }} 外出 {{end}}
                                                        {{if eq .PressureScene 2 }} 检查 {{end}}
                                                        {{if eq .PressureScene 3 }} 请假 {{end}}
                                                        {{if eq .PressureScene 4 }} 拒试 {{end}}
                                                        {{if eq .PressureScene 5 }} 无法侧 {{end}}
                                                        {{if eq .PressureScene 6 }} 未测 {{end}}
                                                    </div>
                                                </td>
                                                <td class="pd0">
                                                    <div class="table-input-bar">
                                                        <input class="input2 ft-center heartrateValue" type="text" id="row1_input10" value="{{.HeartrateValue}}">
                                                    </div>
                                                    <div class="text-msg">
                                                        {{.HeartrateValue}}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="table-input-bar">
                                                        <input type="text" id="row1_input18" class="weightValue" value="{{.WeightValue}}">
                                                        <select id="row1_input19" class="abs weightScene">
                                                                        <option value="0" {{if eq .WeightScene 0 }} selected="" {{end}}>&nbsp; </option>
                                                                        <option value="1" {{if eq .WeightScene 1 }} selected="" {{end}}>卧床</option>
                                                                        <option value="2" {{if eq .WeightScene 2 }} selected="" {{end}}>轮椅</option>
                                                                        <option value="3" {{if eq .WeightScene 3 }} selected="" {{end}}>平车</option>
                                                                    </select>
                                                    </div>
                                                    <div class="text-msg">
                                                        {{.WeightValue}}
                                                        {{if eq .WeightScene 1 }} 卧床 {{end}}
                                                        {{if eq .WeightScene 2 }} 轮椅 {{end}}
                                                        {{if eq .WeightScene 3 }} 平车 {{end}}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="table-input-bar">
                                                        <input type="text" id="row1_input20" class="heightValue" value="{{.HeightValue}}">
                                                        <select id="row1_input21" class="abs heightScene">
                                                                        <option  value="0" {{if eq .HeightScene 0 }} selected="" {{end}}>&nbsp; </option>
                                                                        <option value="1" {{if eq .HeightScene 1 }} selected="" {{end}}>卧床</option>
                                                                        <option value="2" {{if eq .HeightScene 2 }} selected="" {{end}}>轮椅</option>
                                                                        <option value="3" {{if eq .HeightScene 3 }} selected="" {{end}}>平车</option>
                                                                    </select>
                                                    </div>

                                                    <div class="text-msg">
                                                        {{.HeightValue}}
                                                        {{if eq .HeightScene 1 }} 卧床 {{end}}
                                                        {{if eq .HeightScene 2 }} 轮椅 {{end}}
                                                        {{if eq .HeightScene 3 }} 平车 {{end}}
                                                    </div>
                                                </td>
                                                <td class="pd0">
                                                    <div class="table-input-bar">
                                                        <textarea type="text" id="row1_input22" class="skinValue">{{.SkinValue}}</textarea>
                                                    </div>
                                                    <div class="text-msg">
                                                        {{.SkinValue}}
                                                    </div>
                                                </td>
                                                <td class="pd0">
                                                    <div class="table-input-bar">
                                                        <textarea type="text" class="otherValue">{{.OtherValue}}</textarea>
                                                    </div>
                                                    <div class="text-msg">
                                                        {{.OtherValue}}
                                                    </div>
                                                </td>
                                                <td class="pd0">
                                                    <div class="table-input-bar">
                                                    <select class="incidentScene">
                                                        <option {{if eq .IncidentScene 0 }} selected="" {{end}} value="0">&nbsp; </option>
                                                        <option {{if eq .IncidentScene 1 }} selected="" {{end}} value="1">入院</option>
                                                        <option {{if eq .IncidentScene 2 }} selected="" {{end}} value="2">出院</option>
                                                        <option {{if eq .IncidentScene 3 }} selected="" {{end}} value="3">手术</option>
                                                        <option {{if eq .IncidentScene 4 }} selected="" {{end}} value="4">分娩</option>
                                                        <option {{if eq .IncidentScene 5 }} selected="" {{end}} value="5">出生</option>
                                                        <option {{if eq .IncidentScene 6 }} selected="" {{end}} value="6">转入</option>
                                                        <option {{if eq .IncidentScene 7 }} selected="" {{end}} value="7">转科</option>
                                                        <option {{if eq .IncidentScene 8 }} selected="" {{end}} value="8">转院</option>
                                                        <option {{if eq .IncidentScene 9 }} selected="" {{end}} value="9">死亡</option>
                                                    </select>
                                                        <div class="date-box" style="display: inline-block">
                                                            <!--<input type="text" class="am-form-field  date-input2 type2 incidentTime1">-->
                                                            <input type="text" data-timeblcok="{{.TimeFrame}}" data-time="{{.IncidentTime}}" class="am-form-field  time-input2 type2 incidentTime2">
                                                        </div>
                                                    </div>

                                                    <div class="text-msg">
                                                        <!--<p class="txt"><span class="sle-txt">出院</span> <span class="dattiem-txt">2017-09-10 80:00</span> </p>-->
                                                        {{if eq .IncidentScene 1 }} 入院 {{end}}
                                                        {{if eq .IncidentScene 2 }} 出院 {{end}}
                                                        {{if eq .IncidentScene 3 }} 手术 {{end}}
                                                        {{if eq .IncidentScene 4 }} 分娩 {{end}}
                                                        {{if eq .IncidentScene 5 }} 出生 {{end}}
                                                        {{if eq .IncidentScene 6 }} 转入 {{end}}
                                                        {{if eq .IncidentScene 7 }} 转科 {{end}}
                                                        {{if eq .IncidentScene 8 }} 转院 {{end}}
                                                        {{if eq .IncidentScene 9 }} 死亡 {{end}}
                                                        {{.IncidentTime}}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="btn-group2">
                                                        <div class="l">
                                                            <a href="javascript:;" class="save-btn" data-ty="{{.TestTime}}" data-ss="{{.DateTime}}" data-id="{{.ThmId}},{{.PulseId}},{{.BreatheId}},{{.ShitId}},{{.PressureId}},{{.HeartrateId}},{{.WeightId}},{{.HeightId}},{{.SkinId}},{{.OtherId}},{{.IncidentId}}">保存</a>
                                                            <a href="javascript:;" class="edit-btn">
                                                                <i class="am-icon-pencil"></i> 编辑
                                                            </a>
                                                        </div>
                                                        <a href="javascript:;" class="del-btn" data-id="{{.ThmId}},{{.PulseId}},{{.BreatheId}},{{.ShitId}},{{.PressureId}},{{.HeartrateId}},{{.WeightId}},{{.HeightId}},{{.SkinId}},{{.OtherId}},{{.IncidentId}}" data-pulseid="{{.ThmId}}"><i class="am-icon-trash"></i>删除</a>
                                                    </div>
                                                </td>
                                            </tr>
                                        {{end}}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>
                        <input type="hidden" name="starttime" id="starttime">
                        <input type="hidden" name="endtime" id="endtime">
                        <input type="hidden" name="startframe" id="startframe">
                        <input type="hidden" name="endframe" id="endframe">
                        <input type="hidden" name="patient_id" id="patient_id">

                    </form>
                </div>
            </div>
        </div>



    </div>
    </div>


    <!-- navbar -->
    <a href="admin-offcanvas" class="am-icon-btn am-icon-th-list am-show-sm-only admin-menu" data-am-offcanvas="{target: '#admin-offcanvas'}"><!--<i class="fa fa-bars" aria-hidden="true"></i>--></a>

    <script type="text/javascript" src="/static/dist/js/lib/jquery.min.js"></script>
    <!--框架js-->
    <script type="text/javascript" src="/static/dist/js/lib/amazeui_tmplate/amazeui.min.js"></script>
    <!--//遮罩层退出框-->
    <script type="text/javascript" src="/static/dist/js/lib/amazeui_tmplate/blockUI.js"></script>
    <!--<script type="text/javascript" src="../dist/js/lib/amazeui_tmplate/charts/echarts.min.js" ></script>-->
    <!--<script type="text/javascript" src="../dist/js/lib/amazeui_tmplate/charts/indexChart.js" ></script>-->

    <script src="/static/dist/js/lib/laydate/laydate.js"></script>
    <script src="/static/common.js"></script>

    <script>
        /**
         * 节流函数
         */
        var nowFn = Date.now || function() {
            return new Date().getTime()
        }


        function throttle(func, wait, option) {
            var previous = 0, //之前的时间
                timeout, self, args, result;

            var later = function() {
                previous = nowFn();
                timeout = null;
                result = func.apply(self, args);
                !timeout && (self = args = null);
            }
            return function() {
                var now = nowFn();

                if (!previous && option.leading === false) previous = now;
                var diff = wait - (now - previous);

                args = arguments;
                self = this;
                if (diff <= 0) {
                    if (timeout) {
                        clearTimeout(timeout);
                        timeout = null;
                    }
                    result = func.apply(self, args);
                    previous = now;
                    !timeout && (self = args = null); //如果没有堆积的任务 则清空 self 和args
                } else if (!timeout && option.trailing !== false) {
                    timeout = setTimeout(later, diff)
                } else {
                    console.log('被抛弃了')
                }
                return result;

            }
        }
        $('#jky-menu').on('open.collapse.amui', function(e) {
            $(e.target).parents("li").addClass("jky-on")
        })
        $('#jky-menu').on('close.collapse.amui', function(e) {
            $(e.target).parents("li").removeClass("jky-on")
        })



        function toggleTar() {
            if ($('.top48').hasClass('small-type')) {
                $('.top48').removeClass('small-type')
                $('.jky_sidebar').removeClass('small-type')
            } else {
                $('.top48').addClass('small-type')
                $('.jky_sidebar').addClass('small-type')
            }

        }


        $('.s-btn').on('click', function() {
            if ($(this).hasClass('active')) {
                $(this).removeClass('active');
                $('.user-warp').show();

            } else {
                $(this).addClass('active');

                $('.user-warp').hide();
            }




        })

        var nowDateObj = nowDate();

        function nowDate() {
            var res = {},
                nowD = new Date();
            res.date = nowD.getFullYear() + "-" + addZero(nowD.getMonth() + 1) + "-" + addZero(nowD.getDate());
            res.time = addZero(nowD.getHours()) + ":" + addZero(nowD.getMinutes())
            return res
        }

        function addZero(i) {
            if (i < 10) {
                return "0" + i;
            } else {
                return i;
            }
        }

        var keyType = {{.key}};
        if(keyType !=1){
            laydate.render({
                elem: '#date1', //指定元素
                showBottom: false,
                value: {{.starttime}},
                done: function(value, date, endDate) {
                    console.log(value); //得到日期生成的值，如：2017-08-18
                    console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
                    console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
                }
            });

            laydate.render({
                elem: '#date2', //指定元素
                showBottom: false,
                value: {{.endtime}},
                done: function(value, date, endDate) {
                    console.log(value); //得到日期生成的值，如：2017-08-18
                    console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
                    console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
                }
            });

        }else{
            laydate.render({
                elem: '#date1', //指定元素
                showBottom: false,
                value: nowDateObj.date,
                done: function(value, date, endDate) {
                    console.log(value); //得到日期生成的值，如：2017-08-18
                    console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
                    console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
                }
            });

            laydate.render({
                elem: '#date2', //指定元素
                showBottom: false,
                value: nowDateObj.date,
                done: function(value, date, endDate) {
                    console.log(value); //得到日期生成的值，如：2017-08-18
                    console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
                    console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
                }
            });
        }

        /**
        laydate.render({
            elem: '.time-input', //指定元素
            // showBottom: false,
            type: 'time',
            format: 'HH:mm',
            value: nowDateObj.time,
            done: function(value, date, endDate) {
                console.log(value); //得到日期生成的值，如：2017-08-18
                console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
                console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
            }
        });
        **/
        // setTimeout(function(){
        // $('.time-input').val(nowDateObj.time)
        // },0)


        $(window).on('resize', throttle(resizeFn, 500, {
            leading: false, //配置第一次不立即执行 true 第一次执行 false 第一次不执行
            trailing: true // 是否抛弃 还是 往后堆积
        }))

        var h = $('.history-batchInput').height()
        resizeFn()

        function resizeFn() {
            var $el = $('.hd-bar');
            elH = parseFloat($el.css('height'))
            $('.scroll-box').height(h - elH - 20)
            console.log(elH, h)
        }
        var hxScroll = 0,
            zxScroll = 0;
        $('.scroll-box').on('scroll', function() {
            var sl = this.scrollLeft,
                st = this.scrollTop
            if (sl != hxScroll) {
                console.log('横向滚动')
                hxScroll = sl
            }
            if (st != zxScroll) {
                console.log('纵向滚动')
                $('.cont-table.fx').css('top', st)
                zxScroll = st
            }
        })

            // var edit1
        $('body').on('click', '.edit-btn', function() {
            // console.log($(this).parents('tr'))
            var l = $('tr.active').length;
            if (l == 0) {
                $(this).parents('tr').addClass('active')


            } else {
                // alert('暂时未保存，是否放弃修改');
                // alert('修改暂时未保存,请先保存');
                alert('修改信息还未保存')

            }
        });


        laydate.render({
            elem: '.date-input-td', //指定元素
            showBottom: false,
            value: nowDateObj.date,
            done: function(value, date, endDate) {
                console.log(value); //得到日期生成的值，如：2017-08-18
                console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
                console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
            }
        })

        laydate.render({
            elem: '.time-input-td',
            type: 'time',
            format: 'HH:mm',
            btns:["confirm"],
            value: nowDateObj.time,
            done: function(value, date, endDate) {
                console.log(value); //得到日期生成的值，如：2017-08-18
                console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
                console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
            }
        })






        lay('.date-input2').each(function(){
            laydate.render({
                elem: this,
                showBottom: false,
                value: nowDateObj.date,
                done: function(value, date, endDate) {
                    console.log(value); //得到日期生成的值，如：2017-08-18
                    console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
                    console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
                }
            });
        });

        var timeHash = {
            "4":{
                min:"02:00:00",
                max:"05:59:00",
            },
            "8":{
                min:"06:00:00",
                max:"09:59:00",
            },
            "12":{
                min:"10:00:00",
                max:"13:59:59",
            },
            "16":{
                min:"14:00:00",
                max:"17:59:59",
            },
            "20":{
                min:"18:00:00",
                max:"21:59:59",
            },
//            "24":{
//                min:"22:00:00",
//                max:"23:59:59",
//            }
        }


        var hashObj={
            "4":"04:00:00",
            "8":"08:00:00",
            "12":"12:00:00",
            "16":"16:00:00",
            "20":"20:00:00",
            "24":"23:59:59",
        }
        lay('.time-input2').each(function(){
            var $this = $(this)
//            console.log($(this).data("timeblcok"))
            var timeBlock = $(this).data("timeblcok")
            var timeVal = $(this).data("time")
            if(!timeVal){
                timeVal =  hashObj[timeBlock]
            }
            if(timeBlock&&timeVal){
                timeVal = timeVal.slice(timeVal.indexOf(" ")+1)
                timeVal  = timeVal.slice(0,timeVal.length-3);
                $this.data("nowtime",timeVal)
                var option= {
                    elem: this,
                    type: 'time',
                    format: 'HH:mm',
                    btns: ['confirm'],
                    value: timeVal,
                }

                if(timeBlock!="24"){
                    option.min=timeHash[timeBlock].min
                    option.max= timeHash[timeBlock].max
                }else{
                    var ftime = {}, stime = {};
                    ftime.min = new Date();
                    ftime.min.setHours(0);
                    ftime.max = new Date();
                    ftime.max.setHours(1);

                    stime.min = new Date();
                    stime.min.setHours(22);
                    stime.max = new Date();
                    stime.max.setHours(23);

                    option.limitList = new Array(ftime, stime);
                }

                option.done=function(value, date, endDate) {

                    if(timeBlock=="24"){
                        var timeSacp =(date.hours*60+date.minutes)*60 +date.seconds
                        if(timeSacp<79200&&timeSacp>7199){
                            alert("不在范围！！");
                            setTimeout(function(){
                                $this.val($this.data("nowtime"))
                            })
                            return false;
                        }else if(timeSacp<7199){
                            console.log("?")
                            // $this.data-time
                            $this.data("nowtime",value)
                        }else{
                            $this.data("nowtime",value)
                        }
                    }else{
                        $this.data("nowtime",value)
                    }
                }
                laydate.render(option);


            }else{

            }
        });



        $("body").on("click",".save-btn",function(){
            var $this = $(this);
            var $tr = $(this).parents("tr");
            var idStr = $(this).data("id")
            var idArr = idStr.split(",");
            var res ={}
            res["patient_id"]=$.trim( $tr.data("pid")) || ""
            res["nurse_id"]= $.trim( $tr.data("nid")) || ""
            res["nurse_name"]= $.trim( $tr.data("nname")) || ""
            res["test_time"]= $(this).data("ty")

            res["thm_id"] =idArr[0]
            res["thm_value"] =$.trim($tr.find(".thmValue").val())  || ""
            res["thm_type"] =$.trim($tr.find(".thmType").val())  || ""
            res["thm_scene"] =$.trim($tr.find(".thmScene").val())  || ""

            res["pulse_id"] =idArr[1]
            res["pulse_value"] = $.trim($tr.find(".pulseValue").val())  || ""
            if($tr.find(".pulseBriefness").is(":checked")){
                res["pulse_briefness"] ="1"
            }else{
                res["pulse_briefness"] ="0"
            }

            res["breathe_id"] =idArr[2]
            res["breathe_value"] = $.trim($tr.find(".breatheValue").val())  || ""
            res["breathe_scene"] =$.trim($tr.find(".breatheScene").val())  || ""

            res["shit_id"] =idArr[3]
            res["shit_value"] = $.trim($tr.find(".shitValue").val())  || ""
            res["shit_scene"] = $.trim($tr.find(".shitScene").val())  || ""

            res["pressure_id"] =idArr[4]
            res["pressure_dia"] = $.trim($tr.find(".pressureDia").val())|| ""
            res["pressure_sys"] =$.trim($tr.find(".pressureSys").val())  || ""
            if (res["pressure_dia"] == "" && res["pressure_sys"] != "" ||  res["pressure_dia"] != "" && res["pressure_sys"] == "")
            {
                alert("血压参数不完整")
                return
            }
            res["pressure_scene"] = $.trim($tr.find(".pressureScene").val())  || ""

            res["heartrate_id"] =idArr[5]
            res["heartrate_value"] = $.trim($tr.find(".heartrateValue").val())  || ""

            res["weight_id"] =idArr[6]
            res["weight_value"] = $.trim($tr.find(".weightValue").val())  || ""
            res["weight_scene"] = $.trim($tr.find(".weightScene").val())  || ""

            res["height_id"] =idArr[7]
            res["height_value"] = $.trim($tr.find(".heightValue").val())  || ""
            res["height_scene"] = $.trim($tr.find(".heightScene").val())  || ""

            res["skin_id"] =idArr[8]
            res["skin_value"] = $.trim($tr.find(".skinValue").val())  || ""

            res["other_id"] =idArr[9]
            res["other_value"] = $.trim($tr.find(".otherValue").val())  || ""

            res["incident_id"] =idArr[10]
            res["incident_scene"] = $.trim($tr.find(".incidentScene").val())  || ""
            // res["incident_time"] = $(this).data("ss") +" "+ $.trim($tr.find(".incidentTime2").val()) +":00"

//            var reqData ={
//                value:JSON.stringify(res)
//            }

            var timeStr =  $.trim($tr.find(".incidentTime2").val())
            var hour = parseInt(timeStr.split(":")[0])
            var isAddDay = false;
            var dateStr = $(this).data("ss");
            if(hour<2){
                isAddDay = true
            }
            if($(this).data("ss")){
                var date = new Date($(this).data("ss"))
                if(isAddDay){
                    var dateNew = new Date(date.getTime()+24*60*60*1000)
                    dateStr = fromatDate(dateNew).date
                }
                res["incident_time"] = dateStr +" "+ $.trim($tr.find(".incidentTime2").val()) +":00"
            }


            $.post("/pc/patvhupdate", res, function (json, status) {
                //console.log(json, status);
                if (json.result == 0 ) {
                    // alert(json.errmsg)

                    var userArr = []
                    $(".user-bar").find("input[type=checkbox]:checked").each(function(i,el){
                        userArr.push($(el).parents("li").data("id").toString());
                    })
                    console.log(userArr)

                    $("#patient_id").val(userArr)

//        var startTime = $("#date1").val()+" "+startTimeObj[$(".startTimeBlcok").val()]
//        var endTime = "";
//        if($(".endTimeBlock").val()=="24"){
//            var dateStr = $("#date2").val()
//            var dateObj = new Date(dateStr)
//            endTime = fromatDate(dateObj.getTime()+86400000).date +" "+endTimeObj[$(".endTimeBlock").val()]
//        }else{
//            endTime = $("#date2").val()+" "+endTimeObj[$(".endTimeBlock").val()]
//        }
                    var startTime = $("#date1").val(),
                            endTime=$("#date2").val(),
                            startframe=$(".startTimeBlcok").val(),
                            endframe= $(".endTimeBlock").val();

                    console.log(startTime,endTime)

                    $("#starttime").val(startTime)
                    $("#endtime").val(endTime)
                    $("#startframe").val(startframe)
                    $("#endframe").val(endframe)
                    $("#search-from").submit();

                    jkyAlert(json.errmsg,"yes",function(){
                        /*var t1 = $.trim($this.parents("tr").find(".thmValue").val()),
                                t2 = $this.parents("tr").find(".thmType").find("option:selected").text(),
                                t3 = $this.parents("tr").find(".thmScene").find("option:selected").text()
                        console.log(t1,t2,t3,  $this.parents("tr").find(".thmValue").parents("td").find(".text-msg"))
                        var selval = $this.parents("tr").find(".thmScene").val()
                        if((selval==0 ||selval==7)&&!t1){
                            $this.parents("tr").find(".thmValue").parents("td").find(".text-msg").text("")
                        }else{

                            $this.parents("tr").find(".thmValue").parents("td").find(".text-msg").text(t1+" "+t2+" "+t3)
                        }
                        var t4=$this.parents("tr").find(".pulseValue").val(),
                                t5 = $this.parents("tr").find(".pulseBriefness").is(":checked")? "短绌":"";
                        $this.parents("tr").find(".pulseValue").parents("td").find(".text-msg").text(t4+" "+t5)
                        var t6 = $this.parents("tr").find(".breatheValue").val(),
                                t7 = $this.parents("tr").find(".breatheScene").find("option:selected").text()
                        $this.parents("tr").find(".breatheValue").parents("td").find(".text-msg").text(t6+" "+t7)


                        var t8 = $this.parents("tr").find(".shitValue").val(),
                                t9 = $this.parents("tr").find(".pressureScene").find("option:selected").text()
                        $this.parents("tr").find(".shitValue").parents("td").find(".text-msg").text(t8+" "+t9)

                        var t10 = $this.parents("tr").find(".pressureSys").val(),
                                t11 = $this.parents("tr").find(".pressureDia").val(),
                                t12 = $this.parents("tr").find(".pressureScene").find("option:selected").text()
                        $this.parents("tr").find(".pressureSys").parents("td").find(".text-msg").text(t10+"/"+t11+"  "+t12)

                        var t13 = $this.parents("tr").find(".heartrateValue").val();
                        $this.parents("tr").find(".heartrateValue").parents("td").find(".text-msg").text(t13)

                        var t14 = $this.parents("tr").find(".weightValue").val(),
                                t15 = $this.parents("tr").find(".weightScene").find("option:selected").text();
                        $this.parents("tr").find(".weightValue").parents("td").find(".text-msg").text(t14+"  "+t15)

                        var t16 = $this.parents("tr").find(".heightValue").val(),
                                t17 = $this.parents("tr").find(".heightScene").find("option:selected").text();
                        $this.parents("tr").find(".heightValue").parents("td").find(".text-msg").text(t16+"  "+t17)

                        var t18 = $this.parents("tr").find(".skinValue").val();
                        $this.parents("tr").find(".skinValue").parents("td").find(".text-msg").text(t18)

                        var t19 = $this.parents("tr").find(".otherValue").val();
                        $this.parents("tr").find(".otherValue").parents("td").find(".text-msg").text(t19)


                        var t20 = $.trim($this.parents("tr").find(".incidentScene").find("option:selected").text());
                        if(!t20){
                            $this.parents("tr").find(".incidentScene").parents("td").find(".text-msg").text("");
                        }else{
                            var t21 = $this.parents("tr").find(".incidentTime2").data("time")
                            var t22 = $this.parents("tr").find(".incidentTime2").val()
                            $this.parents("tr").find(".incidentScene").parents("td").find(".text-msg").text(t20+" "+t21.slice(0,t21.indexOf(" "))+" "+t22)
                        }

                        $this.parents('tr').removeClass('active')*/

                    })

                } else  {
                    jkyAlert(json.result + json.errmsg+json.Ddatas,"no")
                    // alert(json.result + json.errmsg+json.Ddatas)
                }
            }, 'json');
        })
    </script>

<script>
    $("#all-btn").on("click", function () {
        if($(this).prop("checked")){
            $(".user-bar").find("input[type=checkbox]").prop("checked",true);
        }else{
            $(".user-bar").find("input[type=checkbox]").prop("checked",false);
        }
    })
    $("body").on("click",".user-bar input[type=checkbox]",function(){
        var checklist = $(".user-bar input[type=checkbox]");
        var len = checklist.length,sum=0;
        checklist.each(function(i,el){
            if($(el).prop("checked")){
                sum++;
            }
        })
        if(len == sum){
            $("#all-btn").prop("checked",true)
        }else{
            $("#all-btn").prop("checked",false)
        }
    })
    $(".user-bar").on("click","li",function(e){

        var eTagName=$(e.target)[0].tagName
        var $check = $(this).find("input[type=checkbox]")
        if(eTagName.toLowerCase() != "input"){
            var isCheck = $check.prop("checked")
            $check.prop("checked",!isCheck)

            var checklist = $(".user-bar input[type=checkbox]");
            var len = checklist.length,sum=0;
            checklist.each(function(i,el){
                if($(el).prop("checked")){
                    sum++;
                }
            })
            if(len == sum){
                $("#all-btn").prop("checked",true)
            }else{
                $("#all-btn").prop("checked",false)
            }
        }
    })




//    var startTimeObj ={
//        "4":"02:00:00",
//        "8":"06:00:00",
//        "12":"10:00:00",
//        "16":"14:00:00",
//        "20":"18:00:00",
//        "24":"22:00:00"
//    }
//    var endTimeObj ={
//        "4":"06:00:00",
//        "8":"10:00:00",
//        "12":"14:00:00",
//        "16":"18:00:00",
//        "20":"22:00:00",
//        "24":"02:00:00"
//    }

    $("#search-btn").on("click",function(){
        var userArr = []
        $(".user-bar").find("input[type=checkbox]:checked").each(function(i,el){
            userArr.push($(el).parents("li").data("id").toString());
        })
        console.log(userArr)

        $("#patient_id").val(userArr)

//        var startTime = $("#date1").val()+" "+startTimeObj[$(".startTimeBlcok").val()]
//        var endTime = "";
//        if($(".endTimeBlock").val()=="24"){
//            var dateStr = $("#date2").val()
//            var dateObj = new Date(dateStr)
//            endTime = fromatDate(dateObj.getTime()+86400000).date +" "+endTimeObj[$(".endTimeBlock").val()]
//        }else{
//            endTime = $("#date2").val()+" "+endTimeObj[$(".endTimeBlock").val()]
//        }
        var startTime = $("#date1").val(),
            endTime=$("#date2").val(),
            startframe=$(".startTimeBlcok").val(),
            endframe= $(".endTimeBlock").val();

        console.log(startTime,endTime)

        $("#starttime").val(startTime)
        $("#endtime").val(endTime)
        $("#startframe").val(startframe)
        $("#endframe").val(endframe)
        $("#search-from").submit();
    })


    $("body").on("click",".del-btn",function(){
        var id = $(this).data("id")
        var $this= $(this)
        jkyConfirm("是否确认删除",function(){
            var data = {}
            data["delete_id"]=id;
            $.ajax({
                url: "/pc/patvhdelete",
                data: data,
                type: "POST",
                success: function (data) {
//                console.log(data);
                    if (data) {
                        switch (data.result) {
                            case 0:
                                    jkyAlert("删除成功","yes",function(){
                                        $this.parents("tr").remove()
                                    })
                                break;
                            default:
                                alert(data.errmsg)
                        }
                    }
                },
                error: function (e) {
                    console.log("ajax err:", e)
                },
                dataType: "json"
            })
        })

    })


</script>

</body>

</html>
