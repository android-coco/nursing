<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>见康云护理管理信息系统</title>
    <link rel="stylesheet" href="/static/dist/style/lib/amazeui_tmplate/amazeui.css"/>
    <link rel="stylesheet" href="/static/dist/style/lib/amazeui_tmplate/core.css"/>
    <link rel="stylesheet" href="/static/dist/style/lib/amazeui_tmplate/menu.css"/>
    <link rel="stylesheet" href="/static/dist/style/lib/amazeui_tmplate/admin.css"/>
    <link rel="stylesheet" href="/static/dist/style/lib/amazeui_tmplate/page/typography.css"/>
    <link rel="stylesheet" href="/static/dist/style/lib/amazeui_tmplate/page/form.css"/>
    <link rel="stylesheet" href="/static/dist/style/lib/amazeui_tmplate/component.css"/>
    <link rel="stylesheet" href="/static/dist/style/css/base_pc.min.css">
</head>

<body class="pt48">
<div id="gopng_icon4_outer">
    <div id="gopng_icon4"></div>
</div>
<div class="hd_tit">
    <div class="logo"><img src="/static/dist/images/admin_pc/logo.png"></div>
    <p class="tit">见康云护理管理信息系统_</p>
    <div class="am-dropdown jky_dropdown" data-am-dropdown>
        <button class="am-btn am-btn-primary am-dropdown-toggle" disabled data-am-dropdown-toggle>
            {{.Userinfo.DepartmentName}}
            <span class="jky_icon"><img src="/static/dist/images/admin_pc/xl.png" alt=""></span>
        </button>
        <!--<ul class="am-dropdown-content">-->
        <!--<li class="am-active"><a href="#">内分泌科</a></li>-->
        <!--<li><a href="#">外科</a></li>-->
        <!--<li><a href="#">XXX科</a></li>-->
        <!--<li><a href="#">？？科</a></li>-->
        <!--</ul>-->
    </div>
    <div class="r_menu_list">
        <div class="out_btn">
            <img src="/static/dist/images/admin_pc/out.png" alt=""> 退出
        </div>
    </div>

</div>


<!-- Begin page -->
<div class="am-topbar am-topbar-fixed-top top48 type2">
    <div class="am-topbar-left am-hide-sm-only">
        <a class="username"><span>欢迎你，{{.Userinfo.Name}}</span><i class="zmdi zmdi-layers"></i></a>
    </div>
    <!--
    <div class="contain">
        <div class="jky-class-bar">

        </div>
      <div class="jky-tab-hd">
            <ul>
                <li><a href="./batchInput.html">批量录入</a></li>
                <li class="active"><a href="./batchInput2.html">历史数据</a></li>
            </ul>
        </div>
    </div>
    -->

</div>
<!-- end page -->


<div class="admin">
    <!-- 侧边栏 -->
    <div class="admin-sidebar am-offcanvas  am-padding-0 jky_sidebar type2" id="admin-offcanvas">
        <div class="am-offcanvas-bar admin-offcanvas-bar">

            <ul class="am-list admin-sidebar-list" id="jky-menu">
                <li class="active">
                    <a class="am-cf" href="/pc/device/manage">
                            <span class="jky_icon2">
                                <img src="/static/dist/images/admin_pc/icon10.png" alt="">
                            </span>
                        <span class="tit"> 设备管理 </span>
                        <div class="jky_icon">
                            <img src="/static/dist/images/admin_pc/icon5.png" alt="">
                        </div>
                    </a>
                </li>
                <li>
                    <a class="am-cf none">
                            <span class="jky_icon2">
                                <img src="/static/dist/images/admin_pc/icon11.png" alt="">
                            </span>
                        <span class="tit"> 账号管理 </span>
                        <div class="jky_icon">
                            <img src="/static/dist/images/admin_pc/icon5.png" alt="">
                        </div>
                    </a>
                </li>
                <li>
                    <a class="am-cf" href="/pc/device/manage">
                            <span class="jky_icon2">
                                <img src="/static/dist/images/admin_pc/icon12.png" alt="">
                            </span>
                        <span class="tit"> 服务器地址 </span>
                        <div class="jky_icon">
                            <img src="/static/dist/images/admin_pc/icon5.png" alt="">
                        </div>
                    </a>
                </li>

            </ul>
        </div>
    </div>


    <!-- main -->

    <div class="content-page type2" style="margin-top: 10px;">
        <div class="content ">
            <div class="am-g">
                <div class="device-admin">
                    <div class="device-admin-cont">
                        <div class="hd">
                            <label for="ks-sel">科室选择</label>
                            <select name="" id="ks-sel">
                                {{$c_classname := .Userinfo.DepartmentName}}
                                <option value="all">全部</option>
                                {{range .Departments}}
                                <option value="{{.BCK01}}">{{.BCK03}}</option>
                                {{end}}
                            </select>
                        </div>
                        <div class="cont">
                            <p class="tit">
                                设备套餐名称
                            </p>
                            <div class="line"></div>
                            <div id="change-div">
                                {{range .Devices}}
                                <div class="device-item">
                                    <div class="item-tit">
                                        <span data-id="{{.Id}}">{{.Devicesname}}</span>
                                        <div class="edit-btn">
                                            <div class="icon">
                                                <img src="/static/dist/images/admin_pc/icon35.png" alt="">
                                            </div>
                                            编辑
                                        </div>
                                    </div>

                                    <div class="divice-cont none">
                                        <div class="hide-btn">
                                            收起
                                        </div>

                                        <div class="input-bar">
                                            <input type="text" data-id="{{.Id}}" value="{{.Devicesname}}"
                                                   class="hd-in tc_info">
                                            <div class="del-btn">
                                                <img src="/static/dist/images/admin_pc/icon42.png" alt="">
                                            </div>
                                        </div>
                                        {{range .DeviceInfos}}
                                        <div class="input-bar devietype">
                                            {{if eq .Type "1"}}
                                            <label class="icon"><img class="img1"
                                                                     src="/static/dist/images/admin_pc/icon36.png"
                                                                     alt=""></label>
                                            {{else if eq .Type "2"}}
                                            <label class="icon"><img class="img1"
                                                                     src="/static/dist/images/admin_pc/icon37.png"
                                                                     alt=""></label>
                                            {{else if eq .Type "3"}}
                                            <label class="icon"><img class="img1"
                                                                     src="/static/dist/images/admin_pc/icon38.png"
                                                                     alt=""></label>
                                            {{else if eq .Type "4"}}
                                            <label class="icon"><img class="img1"
                                                                     src="/static/dist/images/admin_pc/icon39.png"
                                                                     alt=""></label>
                                            {{else if eq .Type "5"}}
                                            <label class="icon"><img class="img1"
                                                                     src="/static/dist/images/admin_pc/icon40.png"
                                                                     alt=""></label>
                                            {{else if eq .Type "6"}}
                                            <label class="icon"><img class="img1"
                                                                     src="/static/dist/images/admin_pc/icon41.png"
                                                                     alt=""></label>
                                            {{end}}
                                            <input data-address={{.Address}} data-name={{.Name}} data-type="{{.Type}}"
                                                   type="text" value="{{ .DeviceInforMation}}"
                                                   class="itme-in device_comment">
                                            <div class="del-btn">
                                                <img src="/static/dist/images/admin_pc/icon42.png" alt="">
                                            </div>
                                        </div>
                                        {{end}}
                                        <div class="btn-bar">
                                            <div class="btn ty1 save">保存</div>
                                            <div class="btn colse-btn">关闭</div>
                                        </div>
                                    </div>
                                </div>
                                {{end}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>


<!-- navbar -->
<a href="admin-offcanvas" class="am-icon-btn am-icon-th-list am-show-sm-only admin-menu"
   data-am-offcanvas="{target: '#admin-offcanvas'}"><!--<i class="fa fa-bars" aria-hidden="true"></i>--></a>

<script type="text/javascript" src="/static/dist/js/lib/jquery.min.js"></script>
<!--框架js-->
<script type="text/javascript" src="/static/dist/js/lib/amazeui_tmplate/amazeui.min.js"></script>
<!--//遮罩层退出框-->
<!-- <script type="text/javascript" src="/static/dist/js/lib/amazeui_tmplate/blockUI.js"></script> -->

<!--<script type="text/javascript" src="/static/dist/js/lib/amazeui_tmplate/charts/echarts.min.js" ></script>-->
<!--<script type="text/javascript" src="/static/dist/js/lib/amazeui_tmplate/charts/indexChart.js" ></script>-->

<script src="/static/common.js"></script>
<script>
    /**
     * 节流函数
     */
    var nowFn = Date.now || function () {
        return new Date().getTime()
    }


    function throttle(func, wait, option) {
        var previous = 0, //之前的时间
            timeout, self, args, result;

        var later = function () {
            previous = nowFn();
            timeout = null;
            result = func.apply(self, args);
            !timeout && (self = args = null);
        }
        return function () {
            var now = nowFn();

            if (!previous && option.leading === false) previous = now;
            var diff = wait - (now - previous);

            args = arguments;
            self = this;
            if (diff <= 0) {
                if (timeout) {
                    clearTimeout(timeout);
                    timeout = null;
                }
                result = func.apply(self, args);
                previous = now;
                !timeout && (self = args = null); //如果没有堆积的任务 则清空 self 和args
            } else if (!timeout && option.trailing !== false) {
                timeout = setTimeout(later, diff)
            } else {
                console.log('被抛弃了')
            }
            return result;

        }
    }

    $('#jky-menu').on('open.collapse.amui', function (e) {
        $(e.target).parents("li").addClass("jky-on")
    })
    $('#jky-menu').on('close.collapse.amui', function (e) {
        $(e.target).parents("li").removeClass("jky-on")
    })


    function toggleTar() {
        if ($('.top48').hasClass('small-type')) {
            $('.top48').removeClass('small-type')
            $('.jky_sidebar').removeClass('small-type')
        } else {
            $('.top48').addClass('small-type')
            $('.jky_sidebar').addClass('small-type')
        }

    }

    $('.cont').on('click', '.hide-btn,.colse-btn', function () {
        var $this = $(this),
            $parentEl = $this.parents('.device-item');
        $parentEl.find('.item-tit').removeClass('none');
        $parentEl.find('.divice-cont').addClass('none');


    })
    $('.cont').on('click', '.edit-btn', function () {
        var $this = $(this),
            $parentEl = $this.parents('.device-item');
        $parentEl.find('.divice-cont').removeClass('none');
        $parentEl.find('.item-tit').addClass('none');


    })


    /**
     laydate.render({
            elem: '.time-input', //指定元素
            // showBottom: false,
            type: 'time',
            format: 'HH:mm',
            value: nowDateObj.time,
            done: function(value, date, endDate) {
                console.log(value); //得到日期生成的值，如：2017-08-18
                console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
                console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
            }
        });
     **/
    // setTimeout(function(){
    // $('.time-input').val(nowDateObj.time)
    // },0)


    // $(window).on('resize', throttle(resizeFn, 500, {
    //     leading: false, //配置第一次不立即执行 true 第一次执行 false 第一次不执行
    //     trailing: true // 是否抛弃 还是 往后堆积
    // }))

    // var h = $('.temperatureFrom').height()
    // resizeFn()

    // function resizeFn() {
    //     h = $('.temperatureFrom').height()
    //     var $el = $('.hd-bar');
    //     elH = parseFloat($el.css('height'))
    //     $('.temperature-box').height(h - elH - 10)
    //     console.log(elH, h)
    // }
    //保存
    $('body').on('click', '.save', function () {
        var tcName = $(this).parents('.divice-cont').find(".tc_info").val();//套餐名称
        var tcId = $(this).parents('.divice-cont').find(".tc_info").data("id");//套餐ID
        var $deviceComment = $(this).parents('.divice-cont').find(".device_comment");//设备备注名称
        // var $deviceTypeEl = $(this).parents('.divice-cont').find(".devietype");//设备类型
        var objJson = [];
        $deviceComment.each(function (i, el) {
            var obj = {};
            obj["type"] = $(el).data("type") + '';
            obj["deviceinformation"] = $(el).val();
            obj["devicename"] = tcName;
            obj["name"] = $(el).data("name");
            obj["address"] = $(el).data("address");
            objJson.push(obj);
        })
        // console.log(objJson);

        $.post("/deviceiput", {
            actiontype: 1,
            id: tcId,
            devicesname: tcName,
            devicelist: JSON.stringify(objJson)
        }, function (json, status) {
            console.log(json, status);
            if (json.result == 0) {
                alert(json.errmsg)
            } else {
                alert(json.errmsg)
            }
        }, 'json');
    });
    //筛选
    $("#ks-sel").change(function () {
        var className = $('#ks-sel option:selected').text();//选中的文本
        var classId = $('#ks-sel option:selected').val();//选中的值
        console.log(className + "   " + classId)
        $.post("/pc/device/manage", {
            classid: classId,
        }, function (json, status) {
            // console.log(json, status);
            if (json.result == 0) {
                var resArr = json.datas;
                console.log(resArr);
                var html = '';
                for (var i = 0; i < resArr.length; i++) {
                    html += "<div class=\"device-item\">"
                        + " <div class=\"item-tit\">"
                        + "<span data-id=" + resArr[i].id + ">" + resArr[i].devicesname + "</span>"
                        + " <div class=\"edit-btn\">"
                        + "<div class=\"icon\">"
                        + " <img src=\"/static/dist/images/admin_pc/icon35.png\" alt=\"\">"
                        + "</div> 编辑</div>"
                        + "</div>"
                        + "<div class=\"divice-cont none\">"
                        + " <div class=\"hide-btn\">收起</div>"
                        + "<div class=\"input-bar\">"
                        + " <input type=\"text\" data-id=" + resArr[i].id + " value=" + resArr[i].devicesname + " class=\"hd-in tc_info\">"
                        + " <div class=\"del-btn\">"
                        + "<img src=\"/static/dist/images/admin_pc/icon42.png\" alt=\"\">"
                        + " </div>"
                        + " </div>";
                    for (var j = 0; j < resArr[i].DeviceInfos.length; j++) {
                        html += "<div class=\"input-bar devietype\">";
                        switch (resArr[i].DeviceInfos[j].Type) {
                            case "1":
                                html += " <label class=\"icon\" for=\"\"><img class=\"img1\" src=\"/static/dist/images/admin_pc/icon36.png\" alt=\"\"></label>"
                                break;
                            case "2":
                                html += " <label class=\"icon\" for=\"\"><img class=\"img1\" src=\"/static/dist/images/admin_pc/icon37.png\" alt=\"\"></label>"
                                break;
                            case "3":
                                html += " <label class=\"icon\" for=\"\"><img class=\"img1\" src=\"/static/dist/images/admin_pc/icon38.png\" alt=\"\"></label>"
                                break;
                            case "4":
                                html += " <label class=\"icon\" for=\"\"><img class=\"img1\" src=\"/static/dist/images/admin_pc/icon39.png\" alt=\"\"></label>"
                                break;
                            case "5":
                                html += " <label class=\"icon\" for=\"\"><img class=\"img1\" src=\"/static/dist/images/admin_pc/icon40.png\" alt=\"\"></label>"
                                break;
                            case "6":
                                html += " <label class=\"icon\" for=\"\"><img class=\"img1\" src=\"/static/dist/images/admin_pc/icon41.png\" alt=\"\"></label>"
                                break;
                        }
                        html += "<input data-address=" + resArr[i].DeviceInfos[j].Address + " data-name=" + resArr[i].DeviceInfos[j].Name + " data-type=" + resArr[i].DeviceInfos[j].Type + " type=\"text\" value=" + resArr[i].DeviceInfos[j].DeviceInforMation + " class=\"itme-in device_comment\">"
                            + " <div class=\"del-btn\"> <img src=\"/static/dist/images/admin_pc/icon42.png\" alt= \"\" >"
                            + "</div>" + "</div>";
                    }
                    html += " <div class=\"btn-bar\">"
                        + "<div class=\"btn ty1 save\">保存</div>"
                        + "<div class=\"btn colse-btn\">关闭</div>"
                        + "</div>"
                        + "</div>"
                        + "</div>";
                }
                $("#change-div").html(html)
            } else {
                alert(json.errmsg)
            }
        }, 'json');
    });

    //删除
    $('body').on('click', '.del-btn', function () {
        var index = $(this).parents('.input-bar').index();
        if (index != 1) {
            $(this).parents('.input-bar').remove();
            hideDelBtn();
        } else {
            var isOk = confirm("是否刪除套设备")
            if (isOk) {
                // console.log()
                var tcId = $(this).parents('.input-bar').find('input').data('id');
                var $slef = $(this)
                $.post("/deviceiput", {
                    actiontype: 1,
                    id: tcId,
                }, function (json, status) {
                    console.log(json, status);
                    if (json.result == 0) {
                        $slef.parents('.device-item').remove();//删除完成后隐藏
                        alert(json.errmsg)
                    } else {
                        alert(json.errmsg)
                    }
                }, 'json');
            }

        }
    })
    hideDelBtn();

    function hideDelBtn() {
        $('.divice-cont').each(function (i, el) {
            if ($(el).find(".input-bar").length <= 2) {
                $(el).find(".input-bar").eq(1).find('.del-btn').hide();
            }
        })
    }
</script>
</body>

</html>
